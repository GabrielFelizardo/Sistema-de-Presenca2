<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestor de Eventos v15.0</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <style>
        :root {
            --primary-blue: #1e3a8a;
            --primary-light: #3b82f6;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --shadow-xl: 0 20px 25px rgba(0,0,0,0.15);
        }

        body { background-color: #f8f9fa; font-family: 'Segoe UI', sans-serif; }
        .sidebar { height: 100vh; background: white; border-right: 1px solid #dee2e6; position: fixed; width: 250px; z-index: 100; box-shadow: 0 4px 6px rgba(0,0,0,0.07); }
        .content { margin-left: 250px; padding: 30px; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.95); z-index: 9999; display: none; align-items: center; justify-content: center; flex-direction: column; backdrop-filter: blur(4px); }
        
        .card-stat { border: none; border-radius: 16px; transition: transform 0.2s; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .card-stat:hover { transform: translateY(-4px); box-shadow: 0 10px 15px rgba(0,0,0,0.1); }
        .stat-icon { font-size: 2.5rem; opacity: 0.15; position: absolute; right: 15px; top: 15px; }
        .btn-action { width: 32px; height: 32px; padding: 0; display: inline-flex; align-items: center; justify-content: center; border-radius: 50%; transition: all 0.2s; }
        .btn-action:hover { transform: scale(1.1); }
        
        .nav-tabs { border-bottom: 2px solid #e9ecef; margin-bottom: 20px; }
        .nav-tabs .nav-link { color: #495057; font-weight: 500; border: none; border-bottom: 3px solid transparent; background: transparent; padding: 12px 20px; transition: all 0.2s; }
        .nav-tabs .nav-link:hover { color: var(--primary-light); }
        .nav-tabs .nav-link.active { color: var(--primary-light); font-weight: bold; border-bottom: 3px solid var(--primary-light); }
        
        #qrcode { display: flex; justify-content: center; margin: 20px 0; }
        .ocultar-pdf { display: table-cell; }
        
        .btn { transition: all 0.2s; border-radius: 10px; font-weight: 500; }
        .btn:hover { transform: translateY(-2px); box-shadow: 0 4px 6px rgba(0,0,0,0.07); }
        .btn:active { transform: translateY(0); }
        
        .status-badge { display: inline-flex; align-items-center; gap: 6px; padding: 6px 14px; border-radius: 20px; font-weight: 600; font-size: 0.8rem; }
        
        .toolbar-search { background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .search-input { border-radius: 10px; border: 2px solid #e5e7eb; padding: 10px 16px; transition: all 0.2s; }
        .search-input:focus { border-color: var(--primary-light); box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.1); }
        
        #toast-container { position: fixed; top: 20px; right: 20px; z-index: 10000; }
        .toast-notification { background: white; padding: 16px 20px; border-radius: 12px; box-shadow: var(--shadow-xl); display: flex; align-items: center; gap: 12px; margin-bottom: 10px; animation: slideIn 0.3s; min-width: 320px; }
        .toast-notification.slide-out { animation: slideOut 0.3s; }
        @keyframes slideIn { from { transform: translateX(400px); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        @keyframes slideOut { to { transform: translateX(400px); opacity: 0; } }
        
        .toast-icon { width: 28px; height: 28px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; flex-shrink: 0; }
        .toast-icon.success { background: var(--success); color: white; }
        .toast-icon.error { background: var(--danger); color: white; }
        .toast-icon.warning { background: var(--warning); color: white; }
        .toast-message { color: #374151; font-weight: 500; flex-grow: 1; }
        
        .modal-content { border: none; border-radius: 16px; box-shadow: var(--shadow-xl); }
        .modal-header { border-top-left-radius: 16px; border-top-right-radius: 16px; padding: 20px 24px; }
        .modal-body { padding: 24px; }
        
        .table thead th { background-color: #f8f9fa; font-weight: 600; text-transform: uppercase; font-size: 0.75rem; letter-spacing: 0.5px; padding: 16px 12px; border-bottom: 2px solid #e9ecef; }
        .table tbody tr { transition: all 0.2s; }
        .table tbody tr:hover { background-color: #f8f9fa; }
        
        .sidebar .btn { border-radius: 10px; padding: 12px 16px; transition: all 0.2s; text-align: left; }
        .sidebar .btn:hover { background-color: #f3f4f6; transform: translateX(4px); }
        .sidebar .btn.active { background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-light) 100%); color: white; }
        
        .metrics-card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .metric-item { text-align: center; padding: 12px; }
        .metric-value { font-size: 2rem; font-weight: 700; color: var(--primary-blue); }
        .metric-label { font-size: 0.875rem; color: #6b7280; text-transform: uppercase; }
        
        .toolbar-massa { 
            background: linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); 
            border-left: 4px solid var(--primary-blue);
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 20px;
            display: none;
            animation: slideDown 0.3s;
        }
        
        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .check-convidado { cursor: pointer; width: 18px; height: 18px; }
        
        @media (max-width: 768px) {
            .sidebar { width: 100%; height: auto; position: relative; }
            .content { margin-left: 0; padding: 15px; }
            #toast-container { right: 10px; left: 10px; }
            .toast-notification { min-width: auto; }
        }
    </style>
</head>
<body>

<div id="toast-container"></div>

<div id="loading" class="loading-overlay">
    <div class="spinner-border text-primary" role="status" style="width: 4rem; height: 4rem;"></div>
    <span class="mt-3 fw-bold text-secondary fs-5">Carregando...</span>
</div>

<div class="sidebar p-4 d-flex flex-column">
    <h5 class="text-primary mb-4 fw-bold">
        <i class="fas fa-calendar-check me-2"></i>Gestor RSVP
    </h5>
    <div class="d-grid gap-2">
        <button class="btn btn-light active fw-semibold" onclick="mostrarTela('dashboard')">
            <i class="fas fa-chart-pie me-2 text-primary"></i>Dashboard
        </button>
        <button class="btn btn-light fw-semibold" onclick="mostrarTela('novo')">
            <i class="fas fa-plus me-2 text-success"></i>Novo Evento
        </button>
        <button class="btn btn-light fw-semibold" onclick="mostrarTela('banco-nomes')">
            <i class="fas fa-address-book me-2 text-warning"></i>Gerenciar Nomes
        </button>
        <button class="btn btn-light fw-semibold" data-bs-toggle="modal" data-bs-target="#modalManual">
            <i class="fas fa-book me-2 text-info"></i>Manual de Uso
        </button>
    </div>
    <div class="mt-auto text-muted small pt-3 border-top">
        <div class="d-flex align-items-center justify-content-between">
            <span>v15.0 - Templates & Banco</span>
            <i class="fas fa-layer-group text-primary"></i>
        </div>
    </div>
</div>

<div class="content">
    
    <div id="tela-dashboard">
        
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="fw-bold text-dark m-0">Painel de Controle</h3>
            <div>
                <button class="btn btn-light text-secondary me-2" onclick="abrirModalConfig()" title="Configura√ß√µes do Evento">
                    <i class="fas fa-cog"></i>
                </button>
                <button class="btn btn-light text-secondary" onclick="carregarEventoEspecifico(eventoAtual)" title="Atualizar">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>

        <div class="d-flex align-items-center mb-4">
            <ul class="nav nav-tabs flex-grow-1" id="tab-lista-eventos">
                <li class="nav-item"><a class="nav-link disabled">Carregando eventos...</a></li>
            </ul>
        </div>

        <div id="area-stats" style="display:none;">
            <div class="row mb-4 g-3">
                <div class="col-md-3"><div class="card card-stat bg-white text-dark"><div class="card-body position-relative"><i class="fas fa-users stat-icon text-primary"></i><h6 class="text-uppercase text-muted small fw-bold">Total</h6><h2 class="fw-bold mb-0" id="stat-total">0</h2></div></div></div>
                <div class="col-md-3"><div class="card card-stat bg-success text-white"><div class="card-body position-relative"><i class="fas fa-check-circle stat-icon text-white"></i><h6 class="text-uppercase text-white-50 small fw-bold">Confirmados</h6><h2 class="fw-bold mb-0" id="stat-confirmados">0</h2></div></div></div>
                <div class="col-md-3"><div class="card card-stat bg-warning text-dark"><div class="card-body position-relative"><i class="fas fa-clock stat-icon text-dark"></i><h6 class="text-uppercase text-muted small fw-bold">Pendentes</h6><h2 class="fw-bold mb-0" id="stat-pendentes">0</h2></div></div></div>
                <div class="col-md-3"><div class="card card-stat bg-danger text-white"><div class="card-body position-relative"><i class="fas fa-times-circle stat-icon text-white"></i><h6 class="text-uppercase text-white-50 small fw-bold">Recusados</h6><h2 class="fw-bold mb-0" id="stat-recusados">0</h2></div></div></div>
            </div>

            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="metrics-card">
                        <h6 class="text-center text-muted mb-3 fw-semibold">M√©tricas</h6>
                        <div class="row">
                            <div class="col-6 metric-item border-end">
                                <div class="metric-value" id="taxa-resposta">0%</div>
                                <div class="metric-label">Taxa Resposta</div>
                            </div>
                            <div class="col-6 metric-item">
                                <div class="metric-value text-success" id="percentual-confirmados">0%</div>
                                <div class="metric-label">% Confirmados</div>
                            </div>
                        </div>
                        <div class="text-center mt-3 pt-3 border-top">
                            <small class="text-muted"><i class="fas fa-clock me-1"></i>Atualizado: <span id="ultima-atualizacao">-</span></small>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="card border-0 shadow-sm" style="border-radius: 16px;">
                        <div class="card-body">
                            <h6 class="text-center text-muted mb-3 fw-semibold">Vis√£o Geral</h6>
                            <div style="height: 220px; position: relative;">
                                <canvas id="meuGrafico"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="toolbar-massa" class="toolbar-massa">
            <div class="d-flex align-items-center justify-content-between flex-wrap gap-3">
                <div>
                    <strong><i class="fas fa-check-square me-2"></i><span id="count-selecionados">0</span> selecionados</strong>
                </div>
                <div class="btn-group" role="group">
                    <button class="btn btn-sm btn-success" onclick="atualizarEmMassa('Confirmado')"><i class="fas fa-check me-1"></i>Confirmar</button>
                    <button class="btn btn-sm btn-warning" onclick="atualizarEmMassa('Pendente')"><i class="fas fa-clock me-1"></i>Pendente</button>
                    <button class="btn btn-sm btn-danger" onclick="atualizarEmMassa('N√£o vai')"><i class="fas fa-times me-1"></i>Recusar</button>
                </div>
                
                <button id="btn-massa-email" class="btn btn-sm btn-primary" style="display:none;" onclick="abrirModalEmail()">
                    <i class="fas fa-envelope me-1"></i>Enviar Convite
                </button>

                <button class="btn btn-sm btn-light" onclick="limparSelecao()">
                    <i class="fas fa-times me-1"></i>Limpar
                </button>
            </div>
        </div>

        <div id="toolbar-busca" class="toolbar-search" style="display:none;">
            <div class="row g-3">
                <div class="col-md-6">
                    <div class="input-group">
                        <span class="input-group-text bg-white border-end-0"><i class="fas fa-search text-muted"></i></span>
                        <input type="text" id="busca-rapida" class="form-control border-start-0 search-input" placeholder="Buscar... (Ctrl+K)" onkeyup="filtrarTabela()">
                    </div>
                </div>
                <div class="col-md-3">
                    <select class="form-select search-input" onchange="filtrarPorStatus(this.value)">
                        <option value="">Todos</option>
                        <option value="Confirmado">‚úì Confirmados</option>
                        <option value="Pendente">‚è± Pendentes</option>
                        <option value="N√£o vai">‚úï Recusados</option>
                    </select>
                </div>
                <div class="col-md-3 text-end">
                    <span class="text-muted small"><i class="fas fa-filter me-1"></i><span id="contador-filtrados">0</span> resultados</span>
                </div>
            </div>
        </div>

        <div class="card shadow-sm border-0" style="border-radius: 16px;">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between mb-4 align-items-center pb-3 flex-wrap gap-3">
                    <h5 class="m-0 text-muted fw-semibold" id="titulo-tabela"><i class="fas fa-list me-2"></i>Detalhes</h5>
                    
                    <div id="toolbar-acoes" style="display:none;">
                        <div class="btn-group me-2" role="group">
                            <button class="btn btn-outline-danger" onclick="gerarPDF()"><i class="fas fa-file-pdf me-1"></i> PDF</button>
                            <button class="btn btn-outline-secondary" onclick="gerarTXT()"><i class="fas fa-file-alt me-1"></i> TXT</button>
                            <button class="btn btn-outline-success" onclick="gerarExcel()"><i class="fas fa-file-excel me-1"></i> Excel</button>
                        </div>
                        <button class="btn btn-outline-primary me-2" onclick="abrirModalLink()"><i class="fas fa-qrcode me-2"></i>Link</button>
                        <button class="btn btn-success me-2" onclick="abrirModalImport()"><i class="fas fa-file-excel me-2"></i>Importar</button>
                        <button class="btn btn-primary" onclick="abrirModalAdd()"><i class="fas fa-user-plus me-2"></i>Novo</button>
                    </div>
                </div>

                <div id="container-tabela-exportar" class="table-responsive">
                    <table class="table table-hover align-middle" id="tabela-dados">
                        <thead></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="tela-novo" style="display:none;">
        <h3 class="fw-bold mb-4"><i class="fas fa-plus-circle text-success me-2"></i>Criar Novo Evento</h3>
        <div class="row">
            <div class="col-md-8">
                <div class="card shadow-sm border-0" style="border-radius: 16px;">
                    <div class="card-body p-4">
                        <form onsubmit="handleCriarEvento(event)">
                            <div class="mb-4">
                                <label class="form-label fw-bold">Nome do Evento</label>
                                <input type="text" id="novo-nome" class="form-control form-control-lg" placeholder="Ex: Festa 2024" required>
                            </div>
                            <div class="mb-4">
                                <label class="form-label fw-bold">Modelo</label>
                                <div class="list-group mb-3" style="max-height: 420px; overflow-y: auto;">
                                    <label class="list-group-item list-group-item-action d-flex gap-3 py-3 bg-light" style="cursor: pointer; border-radius: 10px; margin-bottom: 10px;">
                                        <input class="form-check-input" type="radio" name="novo-tipo" value="Importar" onchange="toggleAreaImportacao(true)">
                                        <div><strong><i class="fas fa-file-excel text-success me-2"></i>Importar Excel</strong><br><small class="text-muted">Cole dados do Excel</small></div>
                                    </label>
                                    <label class="list-group-item list-group-item-action d-flex gap-3 py-3" style="cursor: pointer; border-radius: 10px; margin-bottom: 10px;">
                                        <input class="form-check-input" type="radio" name="novo-tipo" value="Basico" checked onchange="toggleAreaImportacao(false)">
                                        <div><strong>üìã B√°sico</strong><br><small class="text-muted">Nome, Email, Telefone, Confirmado</small></div>
                                    </label>
                                    <label class="list-group-item list-group-item-action d-flex gap-3 py-3" style="cursor: pointer; border-radius: 10px; margin-bottom: 10px;">
                                        <input class="form-check-input" type="radio" name="novo-tipo" value="Casamento" onchange="toggleAreaImportacao(false)">
                                        <div><strong>üíí Casamento/Festa</strong><br><small class="text-muted">Completo: Acompanhantes, Mesa, Restri√ß√£o Alimentar</small></div>
                                    </label>
                                    <label class="list-group-item list-group-item-action d-flex gap-3 py-3" style="cursor: pointer; border-radius: 10px; margin-bottom: 10px;">
                                        <input class="form-check-input" type="radio" name="novo-tipo" value="Corporativo" onchange="toggleAreaImportacao(false)">
                                        <div><strong>üíº Corporativo/Palestra</strong><br><small class="text-muted">Empresa, Cargo, Workshop, Networking</small></div>
                                    </label>
                                    <label class="list-group-item list-group-item-action d-flex gap-3 py-3" style="cursor: pointer; border-radius: 10px; margin-bottom: 10px;">
                                        <input class="form-check-input" type="radio" name="novo-tipo" value="Infantil" onchange="toggleAreaImportacao(false)">
                                        <div><strong>üéÇ Festa Infantil</strong><br><small class="text-muted">Nome Crian√ßa, Idade, Respons√°vel, Alergias</small></div>
                                    </label>
                                    <label class="list-group-item list-group-item-action d-flex gap-3 py-3" style="cursor: pointer; border-radius: 10px; margin-bottom: 10px;">
                                        <input class="form-check-input" type="radio" name="novo-tipo" value="Formatura" onchange="toggleAreaImportacao(false)">
                                        <div><strong>üéì Formatura</strong><br><small class="text-muted">Curso, Turma, Qtd Convites, Mesa</small></div>
                                    </label>
                                    <label class="list-group-item list-group-item-action d-flex gap-3 py-3" style="cursor: pointer; border-radius: 10px; margin-bottom: 10px;">
                                        <input class="form-check-input" type="radio" name="novo-tipo" value="Workshop" onchange="toggleAreaImportacao(false)">
                                        <div><strong>üìö Workshop/Curso</strong><br><small class="text-muted">N√≠vel, T√≥picos de Interesse, Material</small></div>
                                    </label>
                                    <label class="list-group-item list-group-item-action d-flex gap-3 py-3" style="cursor: pointer; border-radius: 10px;">
                                        <input class="form-check-input" type="radio" name="novo-tipo" value="Jantar" onchange="toggleAreaImportacao(false)">
                                        <div><strong>üçΩÔ∏è Jantar/Restaurante</strong><br><small class="text-muted">Num. Pessoas, Hor√°rio Preferido, Restri√ß√µes</small></div>
                                    </label>
                                </div>
                                <div id="area-importacao-criacao" class="p-3 bg-light border rounded-3" style="display:none;">
                                    <textarea id="texto-criacao-import" class="form-control mb-2" rows="8" placeholder="Cole aqui..."></textarea>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary btn-lg w-100"><i class="fas fa-rocket me-2"></i>Criar</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

    <!-- TELA: GERENCIAR BANCO DE NOMES -->
    <div id="tela-banco-nomes" style="display:none;">
        <div class="d-flex justify-content-between align-items-center mb-4">
            <h3 class="fw-bold"><i class="fas fa-address-book text-warning me-2"></i>Banco de Nomes</h3>
            <button class="btn btn-outline-primary" onclick="carregarBancoNomes()">
                <i class="fas fa-sync-alt me-1"></i> Atualizar
            </button>
        </div>
        
        <div class="card shadow-sm border-0" style="border-radius: 16px;">
            <div class="card-body p-4">
                <div class="mb-4">
                    <input type="text" id="busca-banco" class="form-control form-control-lg" 
                           placeholder="üîç Buscar por nome..." 
                           onkeyup="filtrarTabelaBanco()">
                </div>
                
                <div class="table-responsive">
                    <table class="table table-hover align-middle" id="tabela-banco">
                        <thead>
                            <tr>
                                <th>Nome</th>
                                <th>Email</th>
                                <th>Telefone</th>
                                <th>Eventos</th>
                                <th>√öltimo Evento</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td colspan="6" class="text-center text-muted">Carregando...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>


<!-- ========================================== -->
<!-- NOVOS MODAIS v15.0 - TEMPLATES + BANCO -->
<!-- ========================================== -->

<!-- MODAL 1: MANUAL DE USO -->
<div class="modal fade" id="modalManual" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title"><i class="fas fa-book me-2"></i>Manual de Uso</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <ul class="nav nav-tabs mb-3" id="manualTabs" role="tablist">
                    <li class="nav-item">
                        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-inicio">
                            <i class="fas fa-rocket me-1"></i>In√≠cio R√°pido
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-convidados">
                            <i class="fas fa-users me-1"></i>Convidados
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-email">
                            <i class="fas fa-envelope me-1"></i>Emails
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-links">
                            <i class="fas fa-link me-1"></i>Links
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-relatorios">
                            <i class="fas fa-chart-bar me-1"></i>Relat√≥rios
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-avancado">
                            <i class="fas fa-cog me-1"></i>Avan√ßado
                        </button>
                    </li>
                    <li class="nav-item">
                        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-atalhos">
                            <i class="fas fa-keyboard me-1"></i>Atalhos
                        </button>
                    </li>
                </ul>

                <div class="tab-content">
                    <!-- TAB: In√≠cio R√°pido -->
                    <div class="tab-pane fade show active" id="tab-inicio">
                        <h6 class="text-primary fw-bold mb-3">üöÄ Primeiros Passos</h6>
                        <ol class="mb-4">
                            <li class="mb-2"><strong>Criar Evento:</strong> Clique em "Novo Evento" e escolha um template ou crie do zero</li>
                            <li class="mb-2"><strong>Adicionar Convidados:</strong> Use o bot√£o "+ Adicionar" ou importe do Excel (Ctrl+I)</li>
                            <li class="mb-2"><strong>Gerar Links:</strong> Selecione convidados e clique em "Gerar Links" para criar confirma√ß√µes personalizadas</li>
                            <li class="mb-2"><strong>Enviar Convites:</strong> Use "Enviar Email" para disparar convites em massa</li>
                            <li class="mb-2"><strong>Acompanhar:</strong> Veja as estat√≠sticas em tempo real no Dashboard</li>
                        </ol>
                        <div class="alert alert-info">
                            <strong>üí° Dica:</strong> Use templates salvos para criar eventos recorrentes mais r√°pido!
                        </div>
                    </div>

                    <!-- TAB: Gerenciar Convidados -->
                    <div class="tab-pane fade" id="tab-convidados">
                        <h6 class="text-primary fw-bold mb-3">üë• Gerenciamento de Convidados</h6>
                        
                        <div class="mb-4">
                            <strong>Adicionar Individualmente:</strong>
                            <p class="text-muted small">Clique "+ Adicionar" ou pressione <kbd>Ctrl+N</kbd>. Preencha os campos e salve.</p>
                        </div>

                        <div class="mb-4">
                            <strong>Importar do Excel:</strong>
                            <ol class="small text-muted">
                                <li>Copie dados do Excel (Ctrl+C)</li>
                                <li>Clique "Importar" ou pressione <kbd>Ctrl+I</kbd></li>
                                <li>Cole os dados (Ctrl+V)</li>
                                <li>Marque se tem cabe√ßalho</li>
                                <li>Confirme importa√ß√£o</li>
                            </ol>
                        </div>

                        <div class="mb-4">
                            <strong>Banco de Nomes:</strong>
                            <p class="text-muted small">Ao adicionar convidados, clique "üîç Buscar no Banco" para ver se a pessoa j√° participou de outros eventos. O sistema preenche dados automaticamente!</p>
                        </div>

                        <div class="mb-4">
                            <strong>Editar/Excluir:</strong>
                            <p class="text-muted small">Clique nos √≠cones ‚úèÔ∏è para editar ou üóëÔ∏è para excluir convidados.</p>
                        </div>

                        <div class="alert alert-success">
                            <strong>‚ú® Novo!</strong> O sistema agora lembra de convidados anteriores e sugere dados ao digitar nomes.
                        </div>
                    </div>

                    <!-- TAB: Campanhas de Email -->
                    <div class="tab-pane fade" id="tab-email">
                        <h6 class="text-primary fw-bold mb-3">‚úâÔ∏è Envio de Emails</h6>
                        
                        <div class="mb-4">
                            <strong>Como usar:</strong>
                            <ol class="small text-muted">
                                <li>Selecione convidados (checkbox)</li>
                                <li>Clique "Enviar Email"</li>
                                <li>Preencha assunto e mensagem</li>
                                <li>Use vari√°veis din√¢micas</li>
                                <li>Confirme envio</li>
                            </ol>
                        </div>

                        <div class="mb-4">
                            <strong>Vari√°veis Din√¢micas:</strong>
                            <ul class="small text-muted">
                                <li><code>{Nome}</code> - Nome do convidado</li>
                                <li><code>{Evento}</code> - Nome do evento</li>
                                <li><code>{Link}</code> - Link personalizado de confirma√ß√£o</li>
                            </ul>
                        </div>

                        <div class="mb-4">
                            <strong>Exemplo de mensagem:</strong>
                            <pre class="bg-light p-3 rounded small">Ol√° {Nome}!

Voc√™ est√° convidado(a) para {Evento}.

Confirme sua presen√ßa clicando no link:
{Link}

Aguardamos voc√™!</pre>
                        </div>

                        <div class="alert alert-warning">
                            <strong>‚ö†Ô∏è Importante:</strong> Emails s√£o enviados com intervalo de 1 segundo. Limite de 50 por vez.
                        </div>
                    </div>

                    <!-- TAB: Links Personalizados -->
                    <div class="tab-pane fade" id="tab-links">
                        <h6 class="text-primary fw-bold mb-3">üîó Links de Confirma√ß√£o</h6>
                        
                        <div class="mb-4">
                            <strong>Gerar Links:</strong>
                            <ol class="small text-muted">
                                <li>Selecione um ou mais convidados</li>
                                <li>Clique "Gerar Links"</li>
                                <li>Sistema cria URLs √∫nicas para cada pessoa</li>
                            </ol>
                        </div>

                        <div class="mb-4">
                            <strong>Compartilhar:</strong>
                            <p class="text-muted small">Ap√≥s gerar, voc√™ pode:</p>
                            <ul class="small text-muted">
                                <li>üìã Copiar link</li>
                                <li>üì± Enviar via WhatsApp</li>
                                <li>üìß Enviar por Email</li>
                                <li>üìÑ Visualizar QR Code</li>
                            </ul>
                        </div>

                        <div class="alert alert-info">
                            <strong>üí° Dica:</strong> QR Codes s√£o perfeitos para eventos presenciais!
                        </div>
                    </div>

                    <!-- TAB: Relat√≥rios -->
                    <div class="tab-pane fade" id="tab-relatorios">
                        <h6 class="text-primary fw-bold mb-3">üìä Exportar Dados</h6>
                        
                        <div class="mb-4">
                            <strong>Exportar para PDF:</strong>
                            <p class="text-muted small">Clique "Exportar PDF" para gerar relat√≥rio completo com estat√≠sticas e lista de convidados.</p>
                        </div>

                        <div class="mb-4">
                            <strong>Exportar para Excel:</strong>
                            <p class="text-muted small">Clique "Exportar Excel" para baixar planilha com todos os dados do evento.</p>
                        </div>

                        <div class="mb-4">
                            <strong>Estat√≠sticas incluem:</strong>
                            <ul class="small text-muted">
                                <li>Total de convidados</li>
                                <li>Confirmados / Pendentes / N√£o v√£o</li>
                                <li>Taxa de confirma√ß√£o</li>
                                <li>Gr√°ficos visuais</li>
                            </ul>
                        </div>
                    </div>

                    <!-- TAB: Recursos Avan√ßados -->
                    <div class="tab-pane fade" id="tab-avancado">
                        <h6 class="text-primary fw-bold mb-3">‚öôÔ∏è Funcionalidades Avan√ßadas</h6>
                        
                        <div class="mb-4">
                            <strong>Templates Personalizados:</strong>
                            <ol class="small text-muted">
                                <li>Configure colunas do seu evento</li>
                                <li>Clique "üíæ Salvar como Template"</li>
                                <li>D√™ um nome ao template</li>
                                <li>Use em eventos futuros!</li>
                            </ol>
                        </div>

                        <div class="mb-4">
                            <strong>Banco de Nomes:</strong>
                            <p class="text-muted small">O sistema memoriza automaticamente todos os convidados adicionados. Ao criar novos eventos, basta buscar pelo nome para recuperar email, telefone e hist√≥rico de participa√ß√£o.</p>
                        </div>

                        <div class="mb-4">
                            <strong>Colunas Customizadas:</strong>
                            <p class="text-muted small">Adicione ou remova colunas conforme necessidade do evento (Ex: "Mesa", "Restri√ß√£o Alimentar", "Workshop Escolhido").</p>
                        </div>

                        <div class="alert alert-success">
                            <strong>‚ú® v15.0:</strong> Templates agora salvam tamb√©m configura√ß√µes de email padr√£o!
                        </div>
                    </div>

                    <!-- TAB: Atalhos de Teclado -->
                    <div class="tab-pane fade" id="tab-atalhos">
                        <h6 class="text-primary fw-bold mb-3">‚å®Ô∏è Atalhos de Teclado</h6>
                        
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Atalho</th>
                                    <th>Fun√ß√£o</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><kbd>Ctrl</kbd> + <kbd>K</kbd></td>
                                    <td>Busca r√°pida de eventos</td>
                                </tr>
                                <tr>
                                    <td><kbd>Ctrl</kbd> + <kbd>N</kbd></td>
                                    <td>Adicionar novo convidado</td>
                                </tr>
                                <tr>
                                    <td><kbd>Ctrl</kbd> + <kbd>I</kbd></td>
                                    <td>Importar do Excel</td>
                                </tr>
                                <tr>
                                    <td><kbd>Ctrl</kbd> + <kbd>R</kbd></td>
                                    <td>Atualizar dados do evento</td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="alert alert-info mt-3">
                            <strong>üí° Dica:</strong> Use atalhos para trabalhar mais r√°pido!
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>

<!-- MODAL 2: SALVAR TEMPLATE -->
<div class="modal fade" id="modalSalvarTemplate" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-warning text-dark">
                <h5 class="modal-title"><i class="fas fa-save me-2"></i>Salvar como Template</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p class="text-muted small">Salve a configura√ß√£o atual deste evento para reutilizar em eventos futuros.</p>
                
                <div class="mb-3">
                    <label class="form-label fw-bold">Nome do Template</label>
                    <input type="text" id="input-nome-template" class="form-control" placeholder="Ex: Reuni√£o Executiva">
                    <small class="text-muted">Escolha um nome descritivo para identificar facilmente.</small>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-bold">Colunas que ser√£o salvas:</label>
                    <div id="preview-colunas-template" class="bg-light p-2 rounded small"></div>
                </div>

                <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" id="check-salvar-email-template">
                    <label class="form-check-label" for="check-salvar-email-template">
                        Salvar configura√ß√µes de email (assunto e mensagem padr√£o)
                    </label>
                </div>

                <div id="preview-email-template" class="bg-light p-3 rounded small" style="display:none;">
                    <strong>Email padr√£o:</strong>
                    <div id="texto-email-template" class="mt-2"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-warning" onclick="confirmarSalvarTemplate()">
                    <i class="fas fa-save me-1"></i>Salvar Template
                </button>
            </div>
        </div>
    </div>
</div>

<!-- MODAL 3: BUSCAR NO BANCO -->
<div class="modal fade" id="modalBuscarBanco" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-success text-white">
                <h5 class="modal-title"><i class="fas fa-search me-2"></i>Buscar no Banco de Nomes</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label fw-bold">Digite o nome:</label>
                    <div class="input-group">
                        <input type="text" id="input-busca-banco" class="form-control" placeholder="Ex: Jo√£o Silva">
                        <button class="btn btn-success" onclick="executarBuscaBanco()">
                            <i class="fas fa-search"></i> Buscar
                        </button>
                    </div>
                </div>

                <div id="resultado-busca-banco"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
            </div>
        </div>
    </div>
</div>

<!-- MODAL 4: SELECIONAR TEMPLATE (ao criar evento) -->
<div class="modal fade" id="modalSelecionarTemplate" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title"><i class="fas fa-layer-group me-2"></i>Selecionar Template</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="lista-templates-disponiveis"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="modalConfig" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-light">
                <h5 class="modal-title">Configura√ß√µes</h5>
                <button class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <h6 class="fw-bold">Renomear Evento</h6>
                <div class="input-group mb-4">
                    <input type="text" id="input-renomear" class="form-control">
                    <button class="btn btn-outline-primary" onclick="salvarRenomeacao()">Salvar</button>
                </div>
                
                <h6 class="fw-bold">Gerenciar Colunas</h6>
                <div class="input-group mb-2">
                    <input type="text" id="input-nova-coluna" class="form-control" placeholder="Nova Coluna (Ex: Empresa)">
                    <button class="btn btn-outline-success" onclick="addColuna()">Adicionar</button>
                </div>
                <ul class="list-group" id="lista-colunas-config"></ul>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalEmail" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title"><i class="fas fa-paper-plane me-2"></i>Enviar Convites</h5>
                <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <p class="text-muted small" id="email-info">Ser√£o enviados e-mails para os contatos selecionados que possuam endere√ßo v√°lido.</p>
                <div class="mb-3">
                    <label class="form-label fw-bold">Assunto</label>
                    <input type="text" id="email-assunto" class="form-control" value="Convite: {Evento}">
                    <div class="form-text">Use {Nome} e {Evento} onde quiser que apare√ßam.</div>
                </div>
                <div class="mb-3">
                    <label class="form-label fw-bold">Mensagem</label>
                    <textarea id="email-mensagem" class="form-control" rows="6">Ol√° {Nome},

Gostar√≠amos muito da sua presen√ßa!
Confirme no link abaixo:

{Link}

Atenciosamente.</textarea>
                    <div class="form-text">Use {Nome}, {Evento} e {Link} para personalizar.</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button class="btn btn-primary" onclick="processarEnvioEmails()"><i class="fas fa-paper-plane me-1"></i>Enviar Agora</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="modalLink" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content"><div class="modal-header bg-primary text-white"><h5 class="modal-title"><i class="fas fa-qrcode me-2"></i>Compartilhar</h5><button class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div><div class="modal-body text-center p-4"><div id="qrcode" class="mb-3"></div><p class="small text-muted mb-4"><i class="fas fa-mobile-alt me-1"></i>Escaneie ou compartilhe</p><div class="input-group mb-3"><input type="text" id="input-link-gerado" class="form-control text-center fw-semibold" readonly><button class="btn btn-outline-primary" onclick="copiarTextoLink()"><i class="fas fa-copy"></i></button></div><div class="d-grid gap-2 mt-3"><button class="btn btn-success" onclick="compartilharWhatsApp()"><i class="fab fa-whatsapp me-2"></i>Compartilhar via WhatsApp</button><button class="btn btn-primary" onclick="compartilharEmail()"><i class="fas fa-envelope me-2"></i>Enviar por Email</button><a id="btn-abrir-link" href="#" target="_blank" class="btn btn-light"><i class="fas fa-external-link-alt me-1"></i>Abrir</a></div></div></div></div></div>
<div class="modal fade" id="modalEditar" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header bg-warning"><h5 class="modal-title text-dark"><i class="fas fa-edit me-2"></i>Editar</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><input type="hidden" id="edit-linha-index"><div id="form-editar-dinamico"></div></div><div class="modal-footer"><button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button><button class="btn btn-warning fw-bold" onclick="salvarEdicao()"><i class="fas fa-save me-1"></i>Salvar</button></div></div></div></div>
<div class="modal fade" id="modalAdd" tabindex="-1"><div class="modal-dialog"><div class="modal-content"><div class="modal-header bg-primary text-white"><h5 class="modal-title"><i class="fas fa-user-plus me-2"></i>Adicionar</h5><button class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div><div class="modal-body" id="form-dinamico"></div><div class="modal-footer"><button class="btn btn-primary fw-bold" onclick="enviarConvidado()"><i class="fas fa-check me-1"></i>Salvar</button></div></div></div></div>
<div class="modal fade" id="modalImport" tabindex="-1"><div class="modal-dialog modal-lg"><div class="modal-content"><div class="modal-header bg-success text-white"><h5 class="modal-title"><i class="fas fa-file-excel me-2"></i>Importar</h5><button class="btn-close btn-close-white" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="form-check form-switch mb-3"><input class="form-check-input" type="checkbox" id="check-headers" checked><label class="form-check-label fw-semibold"><i class="fas fa-table me-1"></i>1¬™ linha √© cabe√ßalho</label></div><textarea id="texto-importacao" class="form-control" rows="10" placeholder="Cole..."></textarea></div><div class="modal-footer"><button class="btn btn-success fw-bold" onclick="processarImportacao()"><i class="fas fa-upload me-1"></i>Processar</button></div></div></div></div>
<div class="modal fade" id="modalConfirmacao" tabindex="-1"><div class="modal-dialog modal-dialog-centered"><div class="modal-content border-0 shadow-lg"><div class="modal-body text-center p-5"><div class="mb-4"><i class="fas fa-exclamation-triangle text-warning" style="font-size: 4rem;"></i></div><h4 class="fw-bold mb-3" id="confirm-titulo">Confirmar?</h4><p class="text-muted" id="confirm-mensagem">Esta a√ß√£o n√£o pode ser desfeita.</p><div class="d-flex gap-3 mt-4"><button class="btn btn-light flex-fill" data-bs-dismiss="modal">Cancelar</button><button class="btn btn-danger flex-fill fw-bold" id="confirm-btn-ok">Confirmar</button></div></div></div></div></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const API_URL = "https://script.google.com/macros/s/AKfycbznlB0UzqjzlkneSPFv1mi_0Jqqtv6DkZsbPctw28isyZvAwyXOBv2tHnQUl1SM1QQ/exec"; 
    const GITHUB_PAGES_URL = window.location.href.substring(0, window.location.href.lastIndexOf('/') + 1);
    let colunasAtuais = [], dadosEventoAtual = [], eventoAtual = "", graficoInstance = null, convidadosSelecionados = [];
    document.addEventListener('DOMContentLoaded', () => { carregarLista(); });
    
    // Fun√ß√µes auxiliares de loading
    function mostrarLoading(show = true) {
        document.getElementById('loading').style.display = show ? 'flex' : 'none';
    }
    function esconderLoading() {
        document.getElementById('loading').style.display = 'none';
    }
    
    function mostrarToast(mensagem, tipo = 'success') {const container = document.getElementById('toast-container');const toast = document.createElement('div');const icons = { success: '‚úì', error: '‚úï', warning: '‚ö†' };toast.className = 'toast-notification';toast.innerHTML = `<span class="toast-icon ${tipo}">${icons[tipo]}</span><span class="toast-message">${mensagem}</span>`;container.appendChild(toast);setTimeout(() => { toast.classList.add('slide-out'); setTimeout(() => toast.remove(), 300); }, 3500);}
    function confirmarAcao(titulo, mensagem) {return new Promise((resolve) => {document.getElementById('confirm-titulo').innerText = titulo;document.getElementById('confirm-mensagem').innerText = mensagem;const modal = new bootstrap.Modal(document.getElementById('modalConfirmacao'));const btnOk = document.getElementById('confirm-btn-ok');btnOk.onclick = () => { modal.hide(); resolve(true); };document.getElementById('modalConfirmacao').addEventListener('hidden.bs.modal', () => { resolve(false); }, { once: true });modal.show();});}
    
    async function chamarAPI(acao, dados = {}) {document.getElementById('loading').style.display = 'flex';try {const response = await fetch(API_URL, {method: 'POST',headers: { "Content-Type": "text/plain;charset=utf-8" },body: JSON.stringify({ acao: acao, ...dados })});const json = await response.json();document.getElementById('loading').style.display = 'none';if (json.erro) { mostrarToast("Erro: " + json.erro, "error"); return null; }return json;} catch (e) {document.getElementById('loading').style.display = 'none';mostrarToast("Erro de conex√£o.", "error");return null;}}
    async function carregarLista() {const dados = await chamarAPI('listarEventos');if (!dados) return;const tabContainer = document.getElementById('tab-lista-eventos');tabContainer.innerHTML = ''; if (dados.length === 0) { tabContainer.innerHTML = '<li class="nav-item"><a class="nav-link disabled">Nenhum evento</a></li>'; return; }dados.forEach((ev, index) => {const li = document.createElement('li'); li.className = 'nav-item';const btn = document.createElement('button'); btn.className = index === 0 ? 'nav-link active' : 'nav-link';btn.innerText = ev.nome; btn.onclick = () => { document.querySelectorAll('#tab-lista-eventos .nav-link').forEach(el => el.classList.remove('active')); btn.classList.add('active'); carregarEventoEspecifico(ev.nome); };li.appendChild(btn); tabContainer.appendChild(li);});if (dados.length > 0) carregarEventoEspecifico(dados[0].nome);}
    async function carregarEventoEspecifico(nome) {if (!nome) return;eventoAtual = nome;const dados = await chamarAPI('obterDadosEvento', { nomeEvento: nome });if (!dados) return;colunasAtuais = dados.headers;dadosEventoAtual = dados.rows;convidadosSelecionados = [];renderizarTabela(dados.headers, dados.rows);atualizarDashboard(dados.headers, dados.rows);const temEmail = dados.headers.some(h => {const limpo = h.toString().trim().toLowerCase();return limpo === 'email' || limpo === 'e-mail';});let emailsValidos = 0;if (temEmail) {const indexEmail = dados.headers.findIndex(h => {const limpo = h.toString().trim().toLowerCase();return limpo === 'email' || limpo === 'e-mail';});dados.rows.forEach(row => {const email = row[indexEmail];if (email && email.toString().includes('@')) {emailsValidos++;}});}const btnEmail = document.getElementById('btn-massa-email');if (temEmail && emailsValidos > 0) {btnEmail.style.display = 'inline-block';btnEmail.title = `${emailsValidos} contato(s) com email v√°lido`;} else if (temEmail && emailsValidos === 0) {btnEmail.style.display = 'none';if (dados.rows.length > 0) {mostrarToast("Coluna Email existe mas nenhum email v√°lido encontrado.", "warning");}} else {btnEmail.style.display = 'none';}document.getElementById('toolbar-acoes').style.display = 'block';document.getElementById('toolbar-busca').style.display = 'block';document.getElementById('toolbar-massa').style.display = 'none';document.getElementById('busca-rapida').value = '';document.querySelector('select.form-select').value = '';mostrarToast(`Evento "${nome}" carregado!`, "success");}
    function atualizarDashboard(headers, rows) {document.getElementById('area-stats').style.display = 'block';const indexStatus = headers.indexOf('Status');let confirmados = 0, pendentes = 0, recusados = 0, total = rows.length;if (indexStatus > -1) {rows.forEach(row => {const status = row[indexStatus] || "Pendente";if (status === 'Confirmado') confirmados++; else if (status === 'N√£o vai') recusados++; else pendentes++;});} else { pendentes = total; }document.getElementById('stat-total').innerText = total; document.getElementById('stat-confirmados').innerText = confirmados; document.getElementById('stat-pendentes').innerText = pendentes; document.getElementById('stat-recusados').innerText = recusados;const taxaResposta = total > 0 ? Math.round(((confirmados + recusados) / total) * 100) : 0;const percentualConfirmados = total > 0 ? Math.round((confirmados / total) * 100) : 0;document.getElementById('taxa-resposta').innerText = taxaResposta + '%';document.getElementById('percentual-confirmados').innerText = percentualConfirmados + '%';document.getElementById('ultima-atualizacao').innerText = new Date().toLocaleString('pt-BR', { day: '2-digit', month: '2-digit', hour: '2-digit', minute: '2-digit' });const ctx = document.getElementById('meuGrafico').getContext('2d');if (graficoInstance) graficoInstance.destroy();graficoInstance = new Chart(ctx, { type: 'doughnut', data: { labels: ['Confirmados', 'Pendentes', 'Recusados'], datasets: [{ data: [confirmados, pendentes, recusados], backgroundColor: ['#10b981', '#f59e0b', '#ef4444'], borderWidth: 0, hoverOffset: 10 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { padding: 15, font: { size: 13 } } } } } });}
    function filtrarTabela() {const termo = document.getElementById('busca-rapida').value.toLowerCase();const linhas = document.querySelectorAll('#tabela-dados tbody tr');let contador = 0;linhas.forEach(linha => {const texto = linha.textContent.toLowerCase();const visivel = texto.includes(termo);linha.style.display = visivel ? '' : 'none';if (visivel) contador++;});document.getElementById('contador-filtrados').innerText = contador;}
    function filtrarPorStatus(status) {const linhas = document.querySelectorAll('#tabela-dados tbody tr');const indexStatus = colunasAtuais.indexOf('Status');let contador = 0;linhas.forEach(linha => {const celulas = linha.querySelectorAll('td');const statusCelula = celulas[indexStatus + 1]?.textContent.replace(/[^a-z√°√©√≠√≥√∫√†√¢√™√¥√£√µ√ß\s]/gi, '').trim();const visivel = !status || statusCelula.includes(status);linha.style.display = visivel ? '' : 'none';if (visivel) contador++;});document.getElementById('contador-filtrados').innerText = contador;}
    function renderizarTabela(headers, rows) {const thead = document.querySelector('#tabela-dados thead');const tbody = document.querySelector('#tabela-dados tbody');let headerHTML = "<tr><th class='ocultar-pdf' style='width: 40px;'><input type='checkbox' onchange='selecionarTodos(this.checked)'></th>";headers.forEach(h => headerHTML += `<th>${h}</th>`);headerHTML += `<th class="text-center ocultar-pdf" style="width: 100px;">A√ß√µes</th></tr>`;thead.innerHTML = headerHTML;if (rows.length === 0) { tbody.innerHTML = `<tr><td colspan="${headers.length + 2}" class="text-center p-5"><i class="fas fa-inbox fa-3x text-muted mb-3 d-block"></i><span class="text-muted">Nenhum convidado</span></td></tr>`; document.getElementById('contador-filtrados').innerText = '0';} else {const statusBadges = {'Confirmado': '<span class="status-badge bg-success text-white"><i class="fas fa-check"></i>Confirmado</span>','Pendente': '<span class="status-badge bg-warning text-dark"><i class="fas fa-clock"></i>Pendente</span>','N√£o vai': '<span class="status-badge bg-danger text-white"><i class="fas fa-times"></i>N√£o vai</span>'};const indexStatus = headers.indexOf('Status');let bodyHTML = "";rows.forEach((row, index) => {bodyHTML += "<tr>";bodyHTML += `<td class="ocultar-pdf"><input type="checkbox" class="check-convidado" data-index="${index}" onchange="toggleSelecao(${index})"></td>`;row.forEach((cell, colIndex) => {if (colIndex === indexStatus && statusBadges[cell]) {bodyHTML += `<td>${statusBadges[cell]}</td>`;} else {bodyHTML += `<td>${cell}</td>`;}});bodyHTML += `<td class="text-center ocultar-pdf"><button class="btn btn-light btn-action text-primary me-1" onclick="abrirModalEditar(${index})"><i class="fas fa-pen"></i></button><button class="btn btn-light btn-action text-danger" onclick="confirmarExclusao(${index})"><i class="fas fa-trash"></i></button></td></tr>`;});tbody.innerHTML = bodyHTML;document.getElementById('contador-filtrados').innerText = rows.length;}}
    function selecionarTodos(checked) {convidadosSelecionados = [];document.querySelectorAll('.check-convidado').forEach(checkbox => {checkbox.checked = checked;if (checked) {convidadosSelecionados.push(parseInt(checkbox.dataset.index));}});atualizarToolbarMassa();}
    function toggleSelecao(index) {const checkbox = document.querySelector(`.check-convidado[data-index="${index}"]`);if (checkbox.checked) {if (!convidadosSelecionados.includes(index)) {convidadosSelecionados.push(index);}} else {convidadosSelecionados = convidadosSelecionados.filter(i => i !== index);}atualizarToolbarMassa();}
    function atualizarToolbarMassa() {const toolbar = document.getElementById('toolbar-massa');const count = document.getElementById('count-selecionados');count.innerText = convidadosSelecionados.length;toolbar.style.display = convidadosSelecionados.length > 0 ? 'block' : 'none';}
    async function atualizarEmMassa(novoStatus) {if (convidadosSelecionados.length === 0) return;const confirmado = await confirmarAcao(`Atualizar ${convidadosSelecionados.length} convidados?`,`Todos ser√£o marcados como "${novoStatus}"`);if (!confirmado) return;const indexStatus = colunasAtuais.indexOf('Status');for (const index of convidadosSelecionados) {const novosDados = [...dadosEventoAtual[index]];novosDados[indexStatus] = novoStatus;await chamarAPI('atualizarConvidado', { nomeEvento: eventoAtual, linha: index + 2, novosDados });}limparSelecao();carregarEventoEspecifico(eventoAtual);mostrarToast(`${convidadosSelecionados.length} atualizados!`, "success");}
    function limparSelecao() {convidadosSelecionados = [];document.querySelectorAll('.check-convidado').forEach(cb => cb.checked = false);document.querySelector('thead input[type="checkbox"]').checked = false;atualizarToolbarMassa();}
    function abrirModalEmail() {if (convidadosSelecionados.length === 0) {mostrarToast("Selecione pelo menos um convidado.", "warning");return;}const temEmail = colunasAtuais.some(h => {const limpo = h.toString().trim().toLowerCase();return limpo === 'email' || limpo === 'e-mail';});if (!temEmail) {mostrarToast("Este evento n√£o possui coluna de Email.", "error");setTimeout(() => {if (confirm("Deseja adicionar a coluna 'Email' agora nas configura√ß√µes?")) {abrirModalConfig();document.getElementById('input-nova-coluna').value = 'Email';document.getElementById('input-nova-coluna').focus();}}, 500);return;}const indexEmail = colunasAtuais.findIndex(h => {const limpo = h.toString().trim().toLowerCase();return limpo === 'email' || limpo === 'e-mail';});const indexNome = colunasAtuais.indexOf('Nome');let comEmail = 0;let semEmail = [];convidadosSelecionados.forEach(index => {const row = dadosEventoAtual[index];const email = row[indexEmail] ? row[indexEmail].toString().trim() : '';if (email && email.includes('@')) {comEmail++;} else {const nome = indexNome > -1 ? row[indexNome] : `Linha ${index+2}`;semEmail.push(nome);}});if (semEmail.length > 0) {const nomes = semEmail.slice(0, 3).join(', ');const extras = semEmail.length > 3 ? ` e mais ${semEmail.length - 3}` : '';const confirmado = confirm(`‚ö†Ô∏è Aten√ß√£o:\n\n` +`${semEmail.length} de ${convidadosSelecionados.length} selecionados N√ÉO t√™m email v√°lido.\n\n` +`Sem email: ${nomes}${extras}\n\n` +`Continuar e enviar apenas para os ${comEmail} com email v√°lido?`);if (!confirmado) return;}if (comEmail === 0) {mostrarToast("Nenhum dos selecionados possui email v√°lido.", "error");return;}document.getElementById('email-info').innerHTML = `<strong class="text-primary">${comEmail} email(s)</strong> ser√£o enviados.` +(semEmail.length > 0 ? ` <span class="text-warning">(${semEmail.length} sem email ser√£o ignorados)</span>` : '');new bootstrap.Modal(document.getElementById('modalEmail')).show();}
    async function processarEnvioEmails() {const assunto = document.getElementById('email-assunto').value.trim();const mensagem = document.getElementById('email-mensagem').value.trim();if (!assunto || !mensagem) {mostrarToast("Preencha assunto e mensagem.", "warning");return;}if (!mensagem.includes('{Link}')) {const confirmado = confirm("‚ö†Ô∏è A mensagem n√£o cont√©m a vari√°vel {Link}.\n\n" +"Os convidados n√£o saber√£o como confirmar presen√ßa.\n\n" +"Continuar mesmo assim?");if (!confirmado) return;}const linkBase = `${GITHUB_PAGES_URL}index.html`; console.log('üìß Enviando emails...');console.log('Evento:', eventoAtual);console.log('Selecionados:', convidadosSelecionados);const res = await chamarAPI('enviarEmails', {nomeEvento: eventoAtual,indices: convidadosSelecionados,assunto: assunto,mensagem: mensagem,linkBase: linkBase});if (res && res.sucesso) {let msg = `‚úÖ ${res.enviados} email(s) enviado(s) com sucesso!`;if (res.erros > 0) {msg += `\n‚ö†Ô∏è ${res.erros} n√£o puderam ser enviados`;}if (res.detalhes && res.detalhes.length > 0) {const detalhes = res.detalhes.slice(0, 5).join('\n‚Ä¢ ');const extras = res.detalhes.length > 5 ? `\n... e mais ${res.detalhes.length - 5}` : '';msg += `\n\nDetalhes:\n‚Ä¢ ${detalhes}${extras}`;}alert(msg);mostrarToast(`${res.enviados} emails enviados!`, "success");bootstrap.Modal.getInstance(document.getElementById('modalEmail')).hide();limparSelecao();} else {mostrarToast("Erro ao enviar emails. Veja console para detalhes.", "error");}}
    function abrirModalConfig() {document.getElementById('input-renomear').value = eventoAtual;const ul = document.getElementById('lista-colunas-config');ul.innerHTML = '';colunasAtuais.forEach(col => {ul.innerHTML += `<li class="list-group-item d-flex justify-content-between align-items-center">${col} <button class="btn btn-sm btn-outline-danger" onclick="rmColuna('${col}')"><i class="fas fa-trash"></i></button></li>`;});new bootstrap.Modal(document.getElementById('modalConfig')).show();}
    async function salvarRenomeacao() {const novo = document.getElementById('input-renomear').value.trim();if(!novo || novo === eventoAtual) return;const res = await chamarAPI('renomearEvento', { nomeAntigo: eventoAtual, nomeNovo: novo });if(res && res.sucesso) {bootstrap.Modal.getInstance(document.getElementById('modalConfig')).hide();carregarLista();mostrarToast("Evento renomeado!", "success");}}
    async function addColuna() {const col = document.getElementById('input-nova-coluna').value.trim();if(!col) {mostrarToast("Digite o nome da coluna.", "warning");return;}const res = await chamarAPI('adicionarColuna', { nomeEvento: eventoAtual, novaColuna: col });if(res && res.sucesso) { mostrarToast(`Coluna '${col}' adicionada!`, "success");abrirModalConfig(); carregarEventoEspecifico(eventoAtual); }}
    async function rmColuna(col) {if(!await confirmarAcao(`Apagar coluna '${col}'?`, "Todos os dados desta coluna ser√£o perdidos.")) return;const res = await chamarAPI('removerColuna', { nomeEvento: eventoAtual, nomeColuna: col });if(res && res.sucesso) { mostrarToast(`Coluna '${col}' removida!`, "success");abrirModalConfig(); carregarEventoEspecifico(eventoAtual); }}
    function gerarPDF() {const elemento = document.getElementById('container-tabela-exportar');const clone = elemento.cloneNode(true);clone.querySelectorAll('.ocultar-pdf').forEach(el => el.remove());const wrapper = document.createElement('div');wrapper.style.padding = '30px';wrapper.style.fontSize = '11px';wrapper.innerHTML = `<div style="text-align: center; margin-bottom: 20px; border-bottom: 2px solid #1e3a8a; padding-bottom: 15px;"><h1 style="color: #1e3a8a; font-family: sans-serif; margin: 0; font-size: 24px;">${eventoAtual}</h1><p style="color: #6b7280; font-family: sans-serif; font-size: 12px; margin: 5px 0 0 0;">Relat√≥rio gerado em ${new Date().toLocaleDateString('pt-BR')} √†s ${new Date().toLocaleTimeString('pt-BR')}</p></div><div style="margin-bottom: 20px;"><table style="width: 100%; font-size: 11px; border-collapse: collapse;"><tr><td style="padding: 5px; border: 1px solid #ddd;"><strong>Total:</strong> ${document.getElementById('stat-total').innerText}</td><td style="padding: 5px; border: 1px solid #ddd;"><strong>Confirmados:</strong> ${document.getElementById('stat-confirmados').innerText}</td><td style="padding: 5px; border: 1px solid #ddd;"><strong>Pendentes:</strong> ${document.getElementById('stat-pendentes').innerText}</td><td style="padding: 5px; border: 1px solid #ddd;"><strong>Recusados:</strong> ${document.getElementById('stat-recusados').innerText}</td></tr></table></div>`;const tabelaClone = clone.querySelector('table');tabelaClone.style.fontSize = '10px';tabelaClone.style.width = '100%';clone.querySelectorAll('th, td').forEach(cell => {cell.style.padding = '6px 4px';cell.style.fontSize = '10px';cell.style.wordBreak = 'break-word';});wrapper.appendChild(clone);const opt = {margin: [15, 10, 15, 10], filename: `${eventoAtual}_${new Date().toISOString().split('T')[0]}.pdf`,image: { type: 'jpeg', quality: 0.95 },html2canvas: { scale: 2, useCORS: true, letterRendering: true },jsPDF: { unit: 'mm', format: 'a4', orientation: 'landscape' }};html2pdf().set(opt).from(wrapper).save().then(() => { mostrarToast("PDF gerado!", "success"); });}
    function gerarTXT() {let texto = `RELAT√ìRIO: ${eventoAtual}\nGerado: ${new Date().toLocaleString('pt-BR')}\n\n`;texto += colunasAtuais.join("\t") + "\n" + "-".repeat(80) + "\n";dadosEventoAtual.forEach(linha => texto += linha.join("\t") + "\n");const blob = new Blob([texto], { type: 'text/plain;charset=utf-8' });const url = window.URL.createObjectURL(blob);const a = document.createElement('a'); a.href = url; a.download = `${eventoAtual}.txt`; a.click();window.URL.revokeObjectURL(url);mostrarToast("TXT baixado!", "success");}
    function gerarExcel() {const ws = XLSX.utils.aoa_to_sheet([colunasAtuais, ...dadosEventoAtual]);const wb = XLSX.utils.book_new();XLSX.utils.book_append_sheet(wb, ws, "Lista");XLSX.writeFile(wb, `${eventoAtual}.xlsx`);mostrarToast("Excel gerado!", "success");}
    function abrirModalEditar(rowIndex) { const dadosRow = dadosEventoAtual[rowIndex]; document.getElementById('edit-linha-index').value = rowIndex; const form = document.getElementById('form-editar-dinamico'); form.innerHTML = ""; colunasAtuais.forEach((col, colIndex) => { const valorAtual = dadosRow[colIndex]; let inputHTML = col === 'Status' ? `<select class="form-control input-editar"><option value="Pendente" ${valorAtual === 'Pendente' ? 'selected' : ''}>Pendente</option><option value="Confirmado" ${valorAtual === 'Confirmado' ? 'selected' : ''}>Confirmado</option><option value="N√£o vai" ${valorAtual === 'N√£o vai' ? 'selected' : ''}>N√£o vai</option></select>` : `<input type="text" class="form-control input-editar" value="${valorAtual}">`; form.innerHTML += `<div class="mb-3"><label class="fw-bold small text-muted">${col}</label>${inputHTML}</div>`; }); new bootstrap.Modal(document.getElementById('modalEditar')).show(); }
    async function salvarEdicao() { const rowIndex = parseInt(document.getElementById('edit-linha-index').value); const inputs = document.querySelectorAll('.input-editar'); const novosDados = Array.from(inputs).map(i => i.value); bootstrap.Modal.getInstance(document.getElementById('modalEditar')).hide(); const res = await chamarAPI('atualizarConvidado', { nomeEvento: eventoAtual, linha: rowIndex + 2, novosDados }); if (res && res.sucesso) { carregarEventoEspecifico(eventoAtual); mostrarToast("Atualizado!", "success"); }}
    async function confirmarExclusao(index) {if (await confirmarAcao("Excluir convidado?", "Essa a√ß√£o n√£o pode ser desfeita.")) {const res = await chamarAPI('excluirConvidado', { nomeEvento: eventoAtual, linha: index + 2 });if (res && res.sucesso) { carregarEventoEspecifico(eventoAtual); mostrarToast("Exclu√≠do!", "success"); }}}
    function abrirModalLink() { if(!eventoAtual) return; const link = `${GITHUB_PAGES_URL}index.html?evento=${encodeURIComponent(eventoAtual)}`; document.getElementById('input-link-gerado').value = link; document.getElementById('btn-abrir-link').href = link; document.getElementById('qrcode').innerHTML = ""; new QRCode(document.getElementById('qrcode'), { text: link, width: 180, height: 180, colorDark: "#1e3a8a" }); new bootstrap.Modal(document.getElementById('modalLink')).show(); }
    function copiarTextoLink() { document.getElementById('input-link-gerado').select(); navigator.clipboard.writeText(document.getElementById('input-link-gerado').value); mostrarToast("Link copiado!", "success"); }
    function compartilharWhatsApp() { const link = document.getElementById('input-link-gerado').value; window.open(`https://wa.me/?text=${encodeURIComponent(`Ol√°! Confirme sua presen√ßa em *${eventoAtual}*:\n\n${link}`)}`, '_blank'); }
    function compartilharEmail() { const link = document.getElementById('input-link-gerado').value; window.location.href = `mailto:?subject=${encodeURIComponent(`Confirma√ß√£o - ${eventoAtual}`)}&body=${encodeURIComponent(`Ol√°!\n\nConfirme sua presen√ßa em ${eventoAtual}:\n\n${link}\n\nObrigado!`)}`; }
    function toggleAreaImportacao(mostrar) { document.getElementById('area-importacao-criacao').style.display = mostrar ? 'block' : 'none'; }
    async function handleCriarEvento(e) { e.preventDefault(); const nome = document.getElementById('novo-nome').value.trim(); const tipo = document.querySelector('input[name="novo-tipo"]:checked').value; let dados = tipo === 'Importar' ? document.getElementById('texto-criacao-import').value : ""; if (tipo === 'Importar' && !dados.trim()) { mostrarToast("Cole os dados do Excel.", "warning"); return; } const res = await chamarAPI('criarNovoEvento', { nome, template: tipo, dadosImportados: dados }); if (res && res.sucesso) { mostrarToast(`"${nome}" criado!`, "success"); mostrarTela('dashboard'); carregarLista(); } }
    function abrirModalImport() { document.getElementById('texto-importacao').value = ""; new bootstrap.Modal(document.getElementById('modalImport')).show(); }
    async function processarImportacao() { const texto = document.getElementById('texto-importacao').value; const temCabecalho = document.getElementById('check-headers').checked; if (!texto.trim()) { mostrarToast("Cole os dados.", "warning"); return; } const linhas = texto.trim().split('\n'); const matriz = linhas.map(l => l.split('\t')); bootstrap.Modal.getInstance(document.getElementById('modalImport')).hide(); const res = await chamarAPI('importarListaConvidados', { nomeEvento: eventoAtual, matrizDados: matriz, temCabecalho }); if (res && res.sucesso) { carregarEventoEspecifico(eventoAtual); mostrarToast(`${res.qtd} importados!`, "success"); } }
    function abrirModalAdd() { const form = document.getElementById('form-dinamico'); form.innerHTML = ""; colunasAtuais.forEach(col => { let inputHTML = col === 'Status' ? `<select class="form-control input-dinamico"><option>Pendente</option><option>Confirmado</option><option>N√£o vai</option></select>` : `<input type="text" class="form-control input-dinamico">`; form.innerHTML += `<div class="mb-3"><label class="fw-bold small text-muted">${col}</label>${inputHTML}</div>`; }); new bootstrap.Modal(document.getElementById('modalAdd')).show(); }
    async function enviarConvidado() { 
        const valores = Array.from(document.querySelectorAll('.input-dinamico')).map(i => i.value); 
        
        if (valores[0] && valores[0].trim() === '') { 
            mostrarToast("Nome obrigat√≥rio.", "warning"); 
            return; 
        } 
        
        bootstrap.Modal.getInstance(document.getElementById('modalAdd')).hide(); 
        
        const res = await chamarAPI('adicionarConvidado', { nomeEvento: eventoAtual, arrayDados: valores }); 
        
        if (res && res.sucesso) { 
            // Salvar no Banco de Nomes
            const nome = valores[0];
            const email = valores[colunasAtuais.indexOf('Email')] || valores[colunasAtuais.indexOf('E-mail')] || '';
            const telefone = valores[colunasAtuais.indexOf('Telefone')] || '';
            
            await chamarAPI('adicionarAoBanco', { 
                nome: nome,
                email: email,
                telefone: telefone,
                nomeEvento: eventoAtual
            });
            
            carregarEventoEspecifico(eventoAtual); 
            mostrarToast("Adicionado!", "success"); 
        } 
    }

// =======================================================================
// FUN√á√ïES v15.0 - TEMPLATES + BANCO DE NOMES
// =======================================================================

// --- TEMPLATES ---

let templatesDisponiveis = [];

async function carregarTemplates() {
    const res = await chamarAPI('listarTemplates', {});
    if (res && res.templates) {
        templatesDisponiveis = res.templates;
    }
}

function abrirModalSelecionarTemplate() {
    const container = document.getElementById('lista-templates-disponiveis');
    
    if (templatesDisponiveis.length === 0) {
        container.innerHTML = `
            <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                Voc√™ ainda n√£o tem templates salvos. Crie um evento e salve-o como template para reutilizar!
            </div>
        `;
    } else {
        let html = '<div class="row g-3">';
        
        templatesDisponiveis.forEach((template, idx) => {
            html += `
                <div class="col-md-6">
                    <div class="card h-100">
                        <div class="card-body">
                            <h6 class="card-title text-primary">${template.nome}</h6>
                            <p class="small text-muted mb-2">
                                <strong>Colunas:</strong> ${template.colunas.join(', ')}
                            </p>
                            <p class="small text-muted mb-2">
                                <i class="fas fa-calendar me-1"></i>${template.dataCriacao}
                                <span class="ms-2"><i class="fas fa-check-circle me-1"></i>${template.vezesUsado}x usado</span>
                            </p>
                            ${template.emailAssunto ? `<span class="badge bg-info">Com email padr√£o</span>` : ''}
                        </div>
                        <div class="card-footer bg-light">
                            <button class="btn btn-sm btn-primary w-100" onclick="usarTemplate(${idx})">
                                <i class="fas fa-plus me-1"></i>Usar Template
                            </button>
                        </div>
                    </div>
                </div>
            `;
        });
        
        html += '</div>';
        container.innerHTML = html;
    }
    
    new bootstrap.Modal(document.getElementById('modalSelecionarTemplate')).show();
}

async function usarTemplate(index) {
    const template = templatesDisponiveis[index];
    
    const nomeEvento = prompt(`Nome do novo evento usando template "${template.nome}":`);
    if (!nomeEvento || !nomeEvento.trim()) return;
    
    let usarEmail = false;
    if (template.emailAssunto) {
        usarEmail = confirm(`Este template tem configura√ß√µes de email padr√£o. Deseja usar?\n\nAssunto: ${template.emailAssunto}`);
    }
    
    mostrarLoading();
    const res = await chamarAPI('criarEventoDeTemplate', {
        nomeEvento: nomeEvento.trim(),
        nomeTemplate: template.nome,
        usarEmail: usarEmail
    });
    esconderLoading();
    
    if (res && res.sucesso) {
        bootstrap.Modal.getInstance(document.getElementById('modalSelecionarTemplate')).hide();
        mostrarToast(`Evento "${res.nome}" criado do template!`, "success");
        
        if (usarEmail && res.emailAssunto) {
            setTimeout(() => {
                alert(`üìß Email padr√£o do template:\n\nAssunto: ${res.emailAssunto}\n\nMensagem: ${res.emailMensagem}\n\nVoc√™ pode usar essas configura√ß√µes ao enviar emails!`);
            }, 500);
        }
        
        carregarLista();
        mostrarTela('dashboard');
    }
}

function abrirModalSalvarTemplate() {
    if (!eventoAtual) {
        mostrarToast("Selecione um evento primeiro.", "warning");
        return;
    }
    
    // Mostrar colunas atuais
    document.getElementById('preview-colunas-template').innerHTML = 
        colunasAtuais.map(col => `<span class="badge bg-primary me-1">${col}</span>`).join('');
    
    document.getElementById('input-nome-template').value = "";
    document.getElementById('check-salvar-email-template').checked = false;
    document.getElementById('preview-email-template').style.display = 'none';
    
    new bootstrap.Modal(document.getElementById('modalSalvarTemplate')).show();
}

document.getElementById('check-salvar-email-template')?.addEventListener('change', function() {
    const preview = document.getElementById('preview-email-template');
    if (this.checked) {
        preview.style.display = 'block';
        document.getElementById('texto-email-template').innerHTML = `
            <small class="text-muted">Configure o email padr√£o na pr√≥xima campanha de email e salve o template.</small>
        `;
    } else {
        preview.style.display = 'none';
    }
});

async function confirmarSalvarTemplate() {
    const nome = document.getElementById('input-nome-template').value.trim();
    
    if (!nome) {
        mostrarToast("Digite um nome para o template.", "warning");
        return;
    }
    
    const salvarEmail = document.getElementById('check-salvar-email-template').checked;
    
    mostrarLoading();
    const res = await chamarAPI('salvarTemplate', {
        nomeTemplate: nome,
        colunas: colunasAtuais,
        emailAssunto: salvarEmail ? (ultimoEmailAssunto || "") : "",
        emailMensagem: salvarEmail ? (ultimoEmailMensagem || "") : ""
    });
    esconderLoading();
    
    if (res && res.sucesso) {
        bootstrap.Modal.getInstance(document.getElementById('modalSalvarTemplate')).hide();
        mostrarToast(`Template "${nome}" salvo com sucesso!`, "success");
        carregarTemplates();
    }
}

let ultimoEmailAssunto = "";
let ultimoEmailMensagem = "";

// --- BANCO DE NOMES ---

function abrirModalBuscaBanco() {
    document.getElementById('input-busca-banco').value = "";
    document.getElementById('resultado-busca-banco').innerHTML = "";
    new bootstrap.Modal(document.getElementById('modalBuscarBanco')).show();
}

async function executarBuscaBanco() {
    const termo = document.getElementById('input-busca-banco').value.trim();
    
    if (!termo) {
        mostrarToast("Digite um nome para buscar.", "warning");
        return;
    }
    
    mostrarLoading();
    const res = await chamarAPI('buscarNoBanco', { termo: termo });
    esconderLoading();
    
    const container = document.getElementById('resultado-busca-banco');
    
    if (!res || !res.encontrado) {
        container.innerHTML = `
            <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle me-2"></i>
                Nenhuma pessoa encontrada com o nome "${termo}".
            </div>
        `;
        return;
    }
    
    let html = '<div class="list-group mt-3">';
    
    res.resultados.forEach((pessoa, idx) => {
        html += `
            <div class="list-group-item">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <h6 class="mb-1 text-primary">${pessoa.nome}</h6>
                        ${pessoa.email ? `<p class="mb-1 small"><i class="fas fa-envelope me-1"></i>${pessoa.email}</p>` : ''}
                        ${pessoa.telefone ? `<p class="mb-1 small"><i class="fas fa-phone me-1"></i>${pessoa.telefone}</p>` : ''}
                        <p class="mb-1 small text-muted">
                            <i class="fas fa-history me-1"></i>
                            <strong>√öltimo evento:</strong> ${pessoa.ultimoEvento} 
                            ${pessoa.dataUltimaParticipacao !== 'N/A' ? `(${pessoa.dataUltimaParticipacao})` : ''}
                        </p>
                        <p class="mb-0 small text-muted">
                            <i class="fas fa-check-circle me-1"></i>
                            Participou de <strong>${pessoa.totalEventos}</strong> evento(s)
                        </p>
                    </div>
                    <button class="btn btn-sm btn-success" onclick="preencherComPessoa(${idx})">
                        <i class="fas fa-plus-circle me-1"></i>Usar
                    </button>
                </div>
            </div>
        `;
    });
    
    html += '</div>';
    container.innerHTML = html;
}

let pessoasEncontradas = [];

async function executarBuscaBancoCompleta() {
    const termo = document.getElementById('input-busca-banco').value.trim();
    
    if (!termo) {
        mostrarToast("Digite um nome para buscar.", "warning");
        return;
    }
    
    mostrarLoading();
    const res = await chamarAPI('buscarNoBanco', { termo: termo });
    esconderLoading();
    
    const container = document.getElementById('resultado-busca-banco');
    
    if (!res || !res.encontrado) {
        container.innerHTML = `
            <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle me-2"></i>
                Nenhuma pessoa encontrada com o nome "${termo}".
            </div>
        `;
        pessoasEncontradas = [];
        return;
    }
    
    pessoasEncontradas = res.resultados;
    
    let html = '<div class="list-group mt-3">';
    
    res.resultados.forEach((pessoa, idx) => {
        html += `
            <div class="list-group-item">
                <div class="d-flex justify-content-between align-items-start">
                    <div class="flex-grow-1">
                        <h6 class="mb-1 text-primary">${pessoa.nome}</h6>
                        ${pessoa.email ? `<p class="mb-1 small"><i class="fas fa-envelope me-1"></i>${pessoa.email}</p>` : ''}
                        ${pessoa.telefone ? `<p class="mb-1 small"><i class="fas fa-phone me-1"></i>${pessoa.telefone}</p>` : ''}
                        <p class="mb-1 small text-muted">
                            <i class="fas fa-history me-1"></i>
                            <strong>√öltimo evento:</strong> ${pessoa.ultimoEvento} 
                            ${pessoa.dataUltimaParticipacao !== 'N/A' ? `(${pessoa.dataUltimaParticipacao})` : ''}
                        </p>
                        <p class="mb-0 small text-muted">
                            <i class="fas fa-check-circle me-1"></i>
                            Participou de <strong>${pessoa.totalEventos}</strong> evento(s)
                        </p>
                    </div>
                    <button class="btn btn-sm btn-success" onclick="preencherComPessoa(${idx})">
                        <i class="fas fa-plus-circle me-1"></i>Usar
                    </button>
                </div>
            </div>
        `;
    });
    
    html += '</div>';
    container.innerHTML = html;
}

function preencherComPessoa(index) {
    const pessoa = pessoasEncontradas[index];
    
    // Preencher inputs do modal adicionar
    const inputs = document.querySelectorAll('.input-dinamico');
    
    colunasAtuais.forEach((col, i) => {
        if (inputs[i]) {
            const colLower = col.toLowerCase();
            
            if (colLower.includes('nome')) {
                inputs[i].value = pessoa.nome;
            } else if (colLower.includes('email') || colLower === 'e-mail') {
                inputs[i].value = pessoa.email || '';
            } else if (colLower.includes('telefone') || colLower.includes('celular')) {
                inputs[i].value = pessoa.telefone || '';
            } else if (colLower.includes('status') || colLower.includes('confirmado')) {
                inputs[i].value = 'Pendente';
            } else {
                inputs[i].value = '';
            }
        }
    });
    
    bootstrap.Modal.getInstance(document.getElementById('modalBuscarBanco')).hide();
    mostrarToast(`Dados de "${pessoa.nome}" preenchidos!`, "success");
}

// Modificar o modal "Adicionar Convidado" para incluir bot√£o de busca
function abrirModalAddComBusca() {
    const form = document.getElementById('form-dinamico');
    form.innerHTML = "";
    
    colunasAtuais.forEach(col => {
        let inputHTML = col === 'Status' || col === 'Confirmado' 
            ? `<select class="form-control input-dinamico"><option>Pendente</option><option>Confirmado</option><option>N√£o vai</option></select>` 
            : `<input type="text" class="form-control input-dinamico">`;
        
        form.innerHTML += `<div class="mb-3"><label class="fw-bold small text-muted">${col}</label>${inputHTML}</div>`;
    });
    
    // Adicionar bot√£o buscar no banco se n√£o existir
    const modalBody = document.querySelector('#modalAdd .modal-body');
    let btnBusca = document.getElementById('btn-busca-banco-inline');
    
    if (!btnBusca) {
        btnBusca = document.createElement('button');
        btnBusca.id = 'btn-busca-banco-inline';
        btnBusca.className = 'btn btn-success w-100 mb-3';
        btnBusca.innerHTML = '<i class="fas fa-search me-2"></i>üîç Buscar no Banco de Nomes';
        btnBusca.type = 'button';
        btnBusca.onclick = function() {
            bootstrap.Modal.getInstance(document.getElementById('modalAdd')).hide();
            setTimeout(() => abrirModalBuscaBanco(), 300);
        };
        modalBody.insertBefore(btnBusca, modalBody.firstChild);
    }
    
    new bootstrap.Modal(document.getElementById('modalAdd')).show();
}

// Atualizar refer√™ncias para usar a nova fun√ß√£o
function abrirModalAdd() {
    abrirModalAddComBusca();
}

// Capturar dados de email para salvar no template
const originalProcessarEnvioEmails = processarEnvioEmails;
async function processarEnvioEmails() {
    ultimoEmailAssunto = document.getElementById('email-assunto').value.trim();
    ultimoEmailMensagem = document.getElementById('email-mensagem').value.trim();
    return await originalProcessarEnvioEmails();
}

// Adicionar bot√£o "Salvar como Template" no painel do evento
function adicionarBotaoSalvarTemplate() {
    const toolbar = document.querySelector('.toolbar-massa');
    if (!toolbar) return;
    
    let btnTemplate = document.getElementById('btn-salvar-template');
    if (btnTemplate) return; // J√° existe
    
    btnTemplate = document.createElement('button');
    btnTemplate.id = 'btn-salvar-template';
    btnTemplate.className = 'btn btn-warning btn-sm ms-2';
    btnTemplate.innerHTML = '<i class="fas fa-save me-1"></i>Salvar como Template';
    btnTemplate.onclick = abrirModalSalvarTemplate;
    
    // Adicionar ao lado do bot√£o de email
    const btnEmail = document.getElementById('btn-massa-email');
    if (btnEmail && btnEmail.parentNode) {
        btnEmail.parentNode.insertBefore(btnTemplate, btnEmail.nextSibling);
    }
}

// Modificar a fun√ß√£o de criar evento para incluir op√ß√£o de templates
const originalHandleCriarEvento = handleCriarEvento;
async function handleCriarEvento(e) {
    e.preventDefault();
    const nome = document.getElementById('novo-nome').value.trim();
    const tipoRadio = document.querySelector('input[name="novo-tipo"]:checked');
    
    if (!tipoRadio) {
        mostrarToast("Selecione um tipo de evento.", "warning");
        return;
    }
    
    const tipo = tipoRadio.value;
    
    // Se escolheu "Template", abrir modal de sele√ß√£o
    if (tipo === 'Template') {
        await carregarTemplates();
        abrirModalSelecionarTemplate();
        return;
    }
    
    // Continuar com cria√ß√£o normal
    return await originalHandleCriarEvento(e);
}

// Inicializar templates ao carregar
window.addEventListener('DOMContentLoaded', function() {
    carregarTemplates();
});

// Executar busca ao pressionar Enter
document.getElementById('input-busca-banco')?.addEventListener('keypress', function(e) {
    if (e.key === 'Enter') {
        executarBuscaBancoCompleta();
    }
});

    document.addEventListener('keydown', (e) => {if ((e.ctrlKey || e.metaKey) && e.key === 'k') { e.preventDefault(); document.getElementById('busca-rapida')?.focus(); }if ((e.ctrlKey || e.metaKey) && e.key === 'n') { e.preventDefault(); if (eventoAtual) abrirModalAdd(); }if ((e.ctrlKey || e.metaKey) && e.key === 'i') { e.preventDefault(); if (eventoAtual) abrirModalImport(); }if ((e.ctrlKey || e.metaKey) && e.key === 'r' && eventoAtual) { e.preventDefault(); carregarEventoEspecifico(eventoAtual); }});
</script>

<!-- Rodap√© com assinatura -->
<footer class="mt-5 pt-4 pb-3 text-center" style="border-top: 1px solid rgba(255,255,255,0.1);">
    <small class="text-muted" style="opacity: 0.7;">
        Sistema RSVP v15.0
        <br>
        Desenvolvido por Gabriel Felizardo | ¬© <span id="ano-atual"></span>
    </small>
</footer>

<script>
    // Atualizar ano automaticamente
    document.getElementById('ano-atual').textContent = new Date().getFullYear();


// =======================================================================
// FUN√á√ïES JAVASCRIPT v15.0 - ADICIONAR NO PAINEL.HTML
// =======================================================================

// --- BANCO DE NOMES ---

async function carregarBancoNomes() {
    mostrarLoading(true);
    const res = await chamarAPI('listarBancoNomes', {});
    mostrarLoading(false);
    
    if (res && res.nomes) {
        renderizarTabelaBanco(res.nomes);
    }
}

function renderizarTabelaBanco(nomes) {
    const tbody = document.querySelector('#tabela-banco tbody');
    
    if (nomes.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="text-center text-muted">Nenhum nome cadastrado ainda.</td></tr>';
        return;
    }
    
    tbody.innerHTML = nomes.map(p => `
        <tr>
            <td><strong>${p.nome}</strong></td>
            <td>${p.email || '<span class="text-muted">-</span>'}</td>
            <td>${p.telefone || '<span class="text-muted">-</span>'}</td>
            <td>
                <span class="badge bg-primary">${p.totalEventos} evento(s)</span>
            </td>
            <td>
                <small class="text-muted">${p.ultimoEvento}</small>
                ${p.dataUltimaParticipacao !== 'N/A' ? `<br><small>(${p.dataUltimaParticipacao})</small>` : ''}
            </td>
            <td>
                <button class="btn btn-sm btn-outline-primary me-1" onclick="editarNomeBanco('${p.nome}', '${p.email}', '${p.telefone}', ${p.totalEventos})" title="Editar">
                    <i class="fas fa-edit"></i>
                </button>
                <button class="btn btn-sm btn-outline-danger" onclick="excluirNomeBanco('${p.nome}')" title="Excluir">
                    <i class="fas fa-trash"></i>
                </button>
            </td>
        </tr>
    `).join('');
}

function filtrarTabelaBanco() {
    const busca = document.getElementById('busca-banco').value.toLowerCase();
    const linhas = document.querySelectorAll('#tabela-banco tbody tr');
    
    linhas.forEach(linha => {
        const texto = linha.textContent.toLowerCase();
        linha.style.display = texto.includes(busca) ? '' : 'none';
    });
}

function editarNomeBanco(nome, email, telefone, totalEventos) {
    document.getElementById('edit-banco-nome-antigo').value = nome;
    document.getElementById('edit-banco-nome').value = nome;
    document.getElementById('edit-banco-email').value = email || '';
    document.getElementById('edit-banco-telefone').value = telefone || '';
    
    // Mostrar alerta de propaga√ß√£o apenas se houver eventos
    const alertPropagar = document.getElementById('alert-propagar');
    if (totalEventos > 0) {
        alertPropagar.style.display = 'block';
        document.getElementById('qtd-eventos-propagar').textContent = totalEventos;
    } else {
        alertPropagar.style.display = 'none';
    }
    
    new bootstrap.Modal(document.getElementById('modalEditarBanco')).show();
}

async function salvarEdicaoBanco() {
    const nomeAntigo = document.getElementById('edit-banco-nome-antigo').value;
    const nomeNovo = document.getElementById('edit-banco-nome').value.trim();
    const email = document.getElementById('edit-banco-email').value.trim();
    const telefone = document.getElementById('edit-banco-telefone').value.trim();
    const propagar = document.getElementById('check-propagar-eventos').checked;
    
    if (!nomeNovo) {
        mostrarToast("Nome n√£o pode estar vazio.", "warning");
        return;
    }
    
    const res = await chamarAPI('editarNoBanco', {
        nomeAntigo: nomeAntigo,
        nomeNovo: nomeNovo,
        email: email,
        telefone: telefone,
        propagarEventos: propagar
    });
    
    if (res && res.sucesso) {
        bootstrap.Modal.getInstance(document.getElementById('modalEditarBanco')).hide();
        
        if (res.propagado) {
            mostrarToast(`Atualizado! ${res.eventosAtualizados} ocorr√™ncia(s) em eventos.`, "success");
        } else {
            mostrarToast("Informa√ß√µes atualizadas!", "success");
        }
        
        carregarBancoNomes();
    }
}

async function excluirNomeBanco(nome) {
    if (!confirm(`Tem certeza que deseja excluir "${nome}" do banco?\n\nOs eventos onde este nome aparece N√ÉO ser√£o afetados.`)) {
        return;
    }
    
    const res = await chamarAPI('excluirDoBanco', { nome: nome });
    
    if (res && res.sucesso) {
        mostrarToast("Nome removido do banco.", "success");
        carregarBancoNomes();
    }
}

// --- BUSCAR NO BANCO AO ADICIONAR CONVIDADO ---

function abrirModalAdd() {
    const form = document.getElementById('form-dinamico');
    form.innerHTML = "";
    
    colunasAtuais.forEach((col, index) => {
        let inputHTML;
        
        // Campo especial para Nome com busca
        if (index === 0 || col.toLowerCase().includes('nome')) {
            inputHTML = `
                <div class="input-group">
                    <input type="text" class="form-control input-dinamico" id="input-nome-busca">
                    <button class="btn btn-outline-primary" type="button" onclick="buscarNomeNoBanco()">
                        <i class="fas fa-search"></i> Buscar
                    </button>
                </div>
                <div id="resultado-busca-banco" class="mt-2"></div>
            `;
        } else if (col === 'Status' || col.toLowerCase() === 'confirmado') {
            inputHTML = `
                <select class="form-control input-dinamico">
                    <option>Pendente</option>
                    <option>Confirmado</option>
                    <option>N√£o vai</option>
                </select>
            `;
        } else {
            inputHTML = `<input type="text" class="form-control input-dinamico" id="input-col-${index}">`;
        }
        
        form.innerHTML += `
            <div class="mb-3">
                <label class="fw-bold small text-muted">${col}</label>
                ${inputHTML}
            </div>
        `;
    });
    
    new bootstrap.Modal(document.getElementById('modalAdd')).show();
}

async function buscarNomeNoBanco() {
    const inputNome = document.getElementById('input-nome-busca');
    const termo = inputNome.value.trim();
    
    if (!termo || termo.length < 2) {
        mostrarToast("Digite pelo menos 2 caracteres para buscar.", "warning");
        return;
    }
    
    mostrarLoading(true);
    const res = await chamarAPI('buscarNoBanco', { termo: termo });
    mostrarLoading(false);
    
    const divResultado = document.getElementById('resultado-busca-banco');
    
    if (res && res.encontrado && res.resultados.length > 0) {
        const pessoa = res.resultados[0]; // Pegar primeiro resultado
        
        divResultado.innerHTML = `
            <div class="alert alert-success">
                <strong>‚úÖ Encontrado no banco!</strong>
                <div class="mt-2">
                    <strong>${pessoa.nome}</strong><br>
                    ${pessoa.email ? `Email: ${pessoa.email}<br>` : ''}
                    ${pessoa.telefone ? `Telefone: ${pessoa.telefone}<br>` : ''}
                    <small class="text-muted">√öltimo evento: ${pessoa.ultimoEvento}</small>
                </div>
                <button class="btn btn-sm btn-success mt-2" onclick="preencherDadosDoBanco('${pessoa.nome}', '${pessoa.email || ''}', '${pessoa.telefone || ''}')">
                    <i class="fas fa-check"></i> Preencher Dados
                </button>
            </div>
        `;
        
        // Verificar se h√° dados novos para atualizar
        verificarAtualizacaoDadosBanco(pessoa.nome);
        
    } else {
        divResultado.innerHTML = `
            <div class="alert alert-info">
                <strong>‚ÑπÔ∏è Nome n√£o encontrado no banco.</strong><br>
                <small>Este ser√° o primeiro evento com "${termo}".</small>
            </div>
        `;
    }
}

function preencherDadosDoBanco(nome, email, telefone) {
    const inputs = document.querySelectorAll('.input-dinamico');
    
    // Preencher campos baseado nas colunas
    colunasAtuais.forEach((col, index) => {
        const colLower = col.toLowerCase();
        
        if (colLower.includes('nome')) {
            inputs[index].value = nome;
        } else if (colLower.includes('email') || colLower === 'e-mail') {
            inputs[index].value = email;
        } else if (colLower.includes('telefone') || colLower.includes('tel') || colLower.includes('fone')) {
            inputs[index].value = telefone;
        }
    });
    
    mostrarToast("Dados preenchidos automaticamente!", "success");
    document.getElementById('resultado-busca-banco').innerHTML = '';
}

async function verificarAtualizacaoDadosBanco(nome) {
    // Pegar valores atuais dos inputs
    const inputs = document.querySelectorAll('.input-dinamico');
    let emailAtual = '';
    let telefoneAtual = '';
    
    colunasAtuais.forEach((col, index) => {
        const colLower = col.toLowerCase();
        
        if (colLower.includes('email') || colLower === 'e-mail') {
            emailAtual = inputs[index].value.trim();
        } else if (colLower.includes('telefone')) {
            telefoneAtual = inputs[index].value.trim();
        }
    });
    
    // Verificar no backend se h√° dados novos
    const res = await chamarAPI('verificarAtualizacaoDados', {
        nome: nome,
        email: emailAtual,
        telefone: telefoneAtual
    });
    
    if (res && res.precisaAtualizar) {
        const mensagens = [];
        
        if (res.emailNovo) {
            mensagens.push(`Email: ${res.emailAtual || '(vazio)'} ‚Üí ${res.emailNovo}`);
        }
        
        if (res.telefoneNovo) {
            mensagens.push(`Telefone: ${res.telefoneAtual || '(vazio)'} ‚Üí ${res.telefoneNovo}`);
        }
        
        const confirmado = confirm(
            `üîÑ Detectamos dados novos para "${res.nome}":\n\n` +
            mensagens.join('\n') +
            `\n\nDeseja atualizar esses dados no banco de nomes?`
        );
        
        if (confirmado) {
            await chamarAPI('atualizarDadosBanco', {
                nome: nome,
                email: res.emailNovo || null,
                telefone: res.telefoneNovo || null
            });
            
            mostrarToast("Banco de nomes atualizado!", "success");
        }
    }
}

// --- TEMPLATES ---

async function salvarEventoComoTemplate() {
    if (!eventoAtual) {
        mostrarToast("Nenhum evento selecionado.", "warning");
        return;
    }
    
    const nomeTemplate = prompt("Digite um nome para este template:");
    
    if (!nomeTemplate || nomeTemplate.trim() === '') return;
    
    // Pegar colunas atuais
    const colunas = colunasAtuais;
    
    // Perguntar se quer salvar email padr√£o
    const incluirEmail = confirm("Deseja salvar um email padr√£o neste template?");
    
    let emailAssunto = '';
    let emailMensagem = '';
    
    if (incluirEmail) {
        emailAssunto = prompt("Assunto do email padr√£o:");
        emailMensagem = prompt("Mensagem do email padr√£o:");
    }
    
    const res = await chamarAPI('salvarTemplate', {
        nomeTemplate: nomeTemplate.trim(),
        colunas: colunas,
        emailAssunto: emailAssunto || '',
        emailMensagem: emailMensagem || ''
    });
    
    if (res && res.sucesso) {
        mostrarToast(`Template "${res.nome}" salvo com sucesso!`, "success");
    }
}

// --- ATUALIZA√á√ÉO DA FUN√á√ÉO DE CONTROLE DE TELAS ---

function mostrarTela(tela) {
    // Ocultar todas as telas
    document.getElementById('tela-dashboard').style.display = 'none';
    document.getElementById('tela-novo').style.display = 'none';
    document.getElementById('tela-banco-nomes').style.display = 'none';
    
    // Mostrar tela selecionada
    if (tela === 'dashboard') {
        document.getElementById('tela-dashboard').style.display = 'block';
    } else if (tela === 'novo') {
        document.getElementById('tela-novo').style.display = 'block';
    } else if (tela === 'banco-nomes') {
        document.getElementById('tela-banco-nomes').style.display = 'block';
        carregarBancoNomes(); // Carregar ao abrir
    }
    
    // Atualizar bot√µes ativos
    document.querySelectorAll('.sidebar .btn').forEach(btn => btn.classList.remove('active'));
    
    if (tela === 'dashboard') {
        document.querySelector('.sidebar .btn:nth-of-type(1)').classList.add('active');
    } else if (tela === 'novo') {
        document.querySelector('.sidebar .btn:nth-of-type(2)').classList.add('active');
    } else if (tela === 'banco-nomes') {
        document.querySelector('.sidebar .btn:nth-of-type(3)').classList.add('active');
    }
}

// --- EXCLUIR EVENTO (MANT√âM NOMES NO BANCO) ---

async function excluirEventoCompleto(nomeEvento) {
    const confirmacao = confirm(
        `‚ö†Ô∏è Tem certeza que deseja excluir o evento "${nomeEvento}"?\n\n` +
        `O evento ser√° removido, mas os nomes dos convidados permanecer√£o no banco de nomes.\n\n` +
        `Esta a√ß√£o n√£o pode ser desfeita.`
    );
    
    if (!confirmacao) return;
    
    // Segunda confirma√ß√£o
    const confirmacao2 = confirm(`Digite OK para confirmar a exclus√£o do evento "${nomeEvento}"`);
    
    if (!confirmacao2) return;
    
    mostrarLoading(true);
    const res = await chamarAPI('excluirEvento', { nomeEvento: nomeEvento });
    mostrarLoading(false);
    
    if (res && res.sucesso) {
        mostrarToast(res.mensagem || "Evento exclu√≠do com sucesso!", "success");
        carregarLista(); // Recarregar lista de eventos
        mostrarTela('dashboard');
    }
}


</script>


<!-- MODAL: EDITAR NOME DO BANCO -->
<div class="modal fade" id="modalEditarBanco" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Editar Informa√ß√µes - Banco de Nomes</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-banco-nome-antigo">
                
                <div class="mb-3">
                    <label class="form-label fw-bold">Nome</label>
                    <input type="text" id="edit-banco-nome" class="form-control">
                </div>
                
                <div class="mb-3">
                    <label class="form-label fw-bold">Email</label>
                    <input type="email" id="edit-banco-email" class="form-control">
                </div>
                
                <div class="mb-3">
                    <label class="form-label fw-bold">Telefone</label>
                    <input type="text" id="edit-banco-telefone" class="form-control">
                </div>
                
                <div class="alert alert-warning" id="alert-propagar" style="display:none;">
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="check-propagar-eventos">
                        <label class="form-check-label" for="check-propagar-eventos">
                            <strong>Atualizar nome em <span id="qtd-eventos-propagar"></span> evento(s)?</strong>
                            <br>
                            <small class="text-muted">As mudan√ßas ser√£o aplicadas em todos os eventos onde este nome aparece.</small>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="salvarEdicaoBanco()">Salvar</button>
            </div>
        </div>
    </div>
</div>

</body>
</html>
